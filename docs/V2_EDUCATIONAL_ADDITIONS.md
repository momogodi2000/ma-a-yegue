# üéì Additions √âducatives v2.0 - Architecture

**Ma'a Yegue Educational Platform**  
**Date:** 7 octobre 2025

---

## üèóÔ∏è Nouveaux Mod√®les de Donn√©es

### 1. Mod√®les √âducatifs Core

**Fichier:** `lib/core/models/educational_models.dart` (530 lignes)

#### Classes Principales

```dart
// Niveaux scolaires
enum GradeLevel { cp, ce1, ce2, cm1, cm2, sixieme, cinquieme, quatrieme, troisieme, seconde, premiere, terminale }
enum EducationLevel { primaire, secondaire1, secondaire2 }

// R√¥les utilisateurs √©tendus
enum UserRole { visitor, student, parent, teacher, substitute, schoolDirector, viceDirector, educationalCounselor, inspector, minEducOfficial, admin, superAdmin }

// √âtablissement scolaire
class School {
  String id, name, code;        // MINEDUC code
  SchoolType type;               // publique, privee, confessionnelle
  String address, city, region;
  String directorId;
  int maxCapacity, currentEnrollment;
  SchoolStatus status;
}

// Classe/Salle
class Classroom {
  String id, schoolId, name;
  GradeLevel gradeLevel;
  String academicYear, teacherId;
  List<String> studentIds;
  int maxCapacity;              // default: 40
  Map<String, dynamic> schedule;
}

// Trimestre acad√©mique
class AcademicTerm {
  String id, name;              // "1er Trimestre"
  int termNumber;                // 1, 2, 3
  String academicYear;
  DateTime startDate, endDate;
  bool isActive;
}

// Note /20
class Grade {
  String id, studentId, classroomId;
  String subject, assessmentType;
  double score, maxScore;        // sur 20
  String termId;
  DateTime date;
  
  // Propri√©t√©s calcul√©es
  double get percentage;         // 0-100
  String get letterGrade;        // A-F
  String get appreciation;       // Fran√ßais
}

// Bulletin scolaire
class ReportCard {
  String id, studentId, classroomId, termId;
  List<SubjectGrade> subjectGrades;
  double overallAverage;
  int rank, totalStudents;
  String generalComment;
  String? teacherComment, directorComment;
  DateTime generatedDate;
}

// Note par mati√®re
class SubjectGrade {
  String subject;
  double average;
  String coefficient, appreciation;
  String? teacherComment;
}

// Pr√©sence
class AttendanceRecord {
  String id, studentId, classroomId;
  DateTime date;
  AttendanceStatus status;       // present, absent, late, excused
  String? reason;
  bool isJustified;
}
```

---

### 2. Mod√®les Enseignants

**Fichier:** `lib/features/teacher/data/models/teacher_models.dart` (370 lignes)

#### Classes Principales

```dart
// Affectation enseignant
class TeacherAssignment {
  String teacherId, classroomId, subject;
  bool isFormTeacher;            // Professeur principal
  int weeklyHours;
  String academicYear;
}

// Emploi du temps
class ClassSchedule {
  String id, classroomId, teacherId;
  DayOfWeek day;                 // monday-saturday
  String startTime, endTime;     // HH:mm
  String subject;
  String? room;
}

// Devoir
class Homework {
  String id, classroomId, teacherId;
  String subject, title, description;
  DateTime assignedDate, dueDate;
  List<String>? attachments;
  double maxPoints;              // d√©faut: 20
  bool isGraded;
}

// Soumission devoir
class HomeworkSubmission {
  String id, homeworkId, studentId;
  DateTime submittedDate;
  String? content;
  List<String>? attachments;
  double? grade;
  String? feedback;
  SubmissionStatus status;       // draft, submitted, graded, late, missing
}

// Plan de le√ßon (cahier de textes)
class LessonPlan {
  String id, classroomId, teacherId;
  String subject;
  DateTime date;
  String topic, objectives, content, materials;
  String? homework;
  int duration;                  // minutes
}

// Note de conduite
class ConductNote {
  String id, studentId, classroomId, teacherId;
  DateTime date;
  ConductType type;              // positive, negative, warning
  String description;
  ConductSeverity severity;      // minor, moderate, major
  String? actionTaken;
  bool parentNotified;
}
```

---

### 3. Mod√®les Parents

**Fichier:** `lib/features/parent/data/models/parent_models.dart` (350 lignes)

#### Classes Principales

```dart
// Relation parent-√©l√®ve
class ParentStudentRelation {
  String id, parentId, studentId;
  ParentRelationType relationType;  // mother, father, guardian
  bool isPrimary;                    // Tuteur principal
  bool canViewGrades, canViewAttendance;
  bool canReceiveNotifications;
  DateTime createdDate;
}

// Message parent-professeur
class ParentTeacherMessage {
  String id, senderId, recipientId, studentId;
  String subject, message;
  DateTime sentDate;
  bool isRead;
  String? threadId;
  List<String>? attachments;
  MessagePriority priority;       // low, normal, high, urgent
}

// Annonce scolaire
class SchoolAnnouncement {
  String id, schoolId;
  String title, content;
  AnnouncementType type;          // general, academic, event, holiday
  DateTime publishDate;
  DateTime? expiryDate;
  String authorId;                // Director or Admin
  bool sendNotification;
  List<String> targetGradeLevels; // Empty = all
}

// Rendez-vous
class ParentTeacherMeeting {
  String id, parentId, teacherId, studentId;
  DateTime scheduledDate;
  String duration;
  MeetingMode mode;               // inPerson, virtual, phone
  String? location;
  String purpose;
  MeetingStatus status;           // scheduled, confirmed, completed
  String? notes, outcome;
}

// R√©sum√© progression
class StudentProgressSummary {
  String studentId, academicYear, termId;
  double overallAverage;
  int classRank, totalStudents;
  Map<String, double> subjectAverages;
  int totalAbsences, justifiedAbsences, tardyCount;
  List<String> strengths, areasForImprovement;
  String teacherComment;
  DateTime lastUpdated;
}
```

---

## üõ†Ô∏è Nouveaux Services

### 1. Content Filter Service

**Fichier:** `lib/core/services/content_filter_service.dart` (270 lignes)

```dart
// 5 niveaux de complexit√©
enum ContentComplexity {
  veryEasy,      // CP, CE1 (6-8 ans)
  easy,          // CE2, CM1 (8-11 ans)
  medium,        // CM2, 6√®me, 5√®me (11-14 ans)
  advanced,      // 4√®me, 3√®me, 2nde (14-16 ans)
  expert         // 1√®re, Terminale (16-18 ans)
}

// Service de filtrage
class ContentFilterService {
  static bool isContentAppropriate({...});
  static ContentComplexity getRecommendedComplexity({...});
  static ContentComplexity forGradeLevel(GradeLevel grade);
  static int getEstimatedReadingTime({...});
  static ValidationResult validateLessonContent({...});
}
```

**Vitesses de Lecture:**
- CP-CE1: 50 mots/minute
- CE2-CM2: 100 mots/minute
- Coll√®ge: 150 mots/minute
- Lyc√©e: 200 mots/minute

---

### 2. Academic Calendar Service

**Fichier:** `lib/core/services/academic_calendar_service.dart` (280 lignes)

```dart
class AcademicCalendarService {
  // G√©n√©ration trimestres camerounais
  static List<AcademicTerm> generateCameroonTerms(String year);
  
  // Ann√©e acad√©mique actuelle
  static String getCurrentAcademicYear();
  
  // Trimestre actuel
  static AcademicTerm? getCurrentTerm();
  
  // Jours f√©ri√©s Cameroun
  static List<AcademicHoliday> getCameroonHolidays(String year);
  
  // V√©rification jour d'√©cole
  static bool isSchoolDay(DateTime date);
  
  // Comptage jours
  static int getSchoolDaysInTerm(AcademicTerm term);
  
  // √âv√©nements acad√©miques
  static List<AcademicEvent> getAcademicEvents(String year);
  
  // Progression trimestre
  static double getTermProgress(AcademicTerm term);
  
  // Prochain √©v√©nement
  static AcademicEvent? getNextEvent();
}
```

**Calendrier Camerounais:**
- 1er Trimestre: 1 sept ‚Üí 15 d√©c
- 2√®me Trimestre: 5 jan ‚Üí 5 avr
- 3√®me Trimestre: 15 avr ‚Üí 10 juil

---

## üîÑ Int√©gration Architecture Existante

### Communication avec Modules Existants

#### 1. Authentication Module
```dart
// R√¥les √©tendus
enum UserRole {
  visitor, student, parent,      // Nouveaux
  teacher, substitute,           // √âtendus
  schoolDirector, inspector,     // Nouveaux
  admin, superAdmin              // √âtendus
}

// Propri√©t√©s utilisateur enrichies
class User {
  String role;                   // UserRole as string
  String? schoolId;              // √âcole d'affectation
  String? classroomId;           // Classe (pour √©l√®ves)
  GradeLevel? gradeLevel;        // Niveau scolaire (√©l√®ves)
  List<String>? childrenIds;     // Enfants (parents)
}
```

#### 2. Lessons Module
```dart
// Le√ßons avec niveau
class Lesson {
  // Existant
  String id, title, content;
  
  // Nouveau v2.0
  ContentComplexity? complexity;  // Niveau difficult√©
  List<GradeLevel>? targetGrades; // Niveaux cibles
  int? estimatedTime;            // Minutes par √¢ge
}
```

#### 3. Assessment Module
```dart
// Quiz avec notation /20
class Quiz {
  // Existant
  String id, title;
  List<Question> questions;
  
  // Nouveau v2.0
  double maxScore = 20.0;        // Note sur 20
  GradeLevel? targetGrade;       // Niveau cible
  String? termId;                // Trimestre
}

// R√©sultat quiz
class QuizResult {
  double score;                  // Sur 20
  
  // Nouveau v2.0
  String get letterGrade;        // A-F
  String get appreciation;       // Fran√ßais
}
```

#### 4. Dashboard Module
```dart
// Dashboards diff√©renci√©s
switch (userRole) {
  case UserRole.student:
    return StudentDashboard(gradeLevel: user.gradeLevel);
  
  case UserRole.teacher:
    return TeacherDashboard(classrooms: teacherClassrooms);
  
  case UserRole.parent:
    return ParentDashboard(children: user.childrenIds);
  
  case UserRole.schoolDirector:
    return DirectorDashboard(school: user.schoolId);
  
  case UserRole.visitor:
    return GuestDashboard();
}
```

---

## üìä Collections Firestore

### Structure Propos√©e

```
firestore/
‚îú‚îÄ‚îÄ schools/{schoolId}
‚îÇ   ‚îú‚îÄ‚îÄ name, code, type
‚îÇ   ‚îú‚îÄ‚îÄ directorId
‚îÇ   ‚îú‚îÄ‚îÄ region, city
‚îÇ   ‚îî‚îÄ‚îÄ status
‚îÇ
‚îú‚îÄ‚îÄ classrooms/{classroomId}
‚îÇ   ‚îú‚îÄ‚îÄ schoolId
‚îÇ   ‚îú‚îÄ‚îÄ gradeLevel
‚îÇ   ‚îú‚îÄ‚îÄ teacherId
‚îÇ   ‚îú‚îÄ‚îÄ studentIds[]
‚îÇ   ‚îú‚îÄ‚îÄ academicYear
‚îÇ   ‚îî‚îÄ‚îÄ schedule{}
‚îÇ
‚îú‚îÄ‚îÄ grades/{gradeId}
‚îÇ   ‚îú‚îÄ‚îÄ studentId
‚îÇ   ‚îú‚îÄ‚îÄ classroomId
‚îÇ   ‚îú‚îÄ‚îÄ subject
‚îÇ   ‚îú‚îÄ‚îÄ score (/20)
‚îÇ   ‚îú‚îÄ‚îÄ termId
‚îÇ   ‚îî‚îÄ‚îÄ date
‚îÇ
‚îú‚îÄ‚îÄ report_cards/{reportCardId}
‚îÇ   ‚îú‚îÄ‚îÄ studentId
‚îÇ   ‚îú‚îÄ‚îÄ termId
‚îÇ   ‚îú‚îÄ‚îÄ subjectGrades[]
‚îÇ   ‚îú‚îÄ‚îÄ overallAverage
‚îÇ   ‚îú‚îÄ‚îÄ rank
‚îÇ   ‚îî‚îÄ‚îÄ comments
‚îÇ
‚îú‚îÄ‚îÄ attendance/{attendanceId}
‚îÇ   ‚îú‚îÄ‚îÄ studentId
‚îÇ   ‚îú‚îÄ‚îÄ classroomId
‚îÇ   ‚îú‚îÄ‚îÄ date
‚îÇ   ‚îú‚îÄ‚îÄ status
‚îÇ   ‚îî‚îÄ‚îÄ reason
‚îÇ
‚îú‚îÄ‚îÄ homework/{homeworkId}
‚îÇ   ‚îú‚îÄ‚îÄ classroomId
‚îÇ   ‚îú‚îÄ‚îÄ teacherId
‚îÇ   ‚îú‚îÄ‚îÄ subject
‚îÇ   ‚îú‚îÄ‚îÄ title, description
‚îÇ   ‚îú‚îÄ‚îÄ assignedDate, dueDate
‚îÇ   ‚îî‚îÄ‚îÄ maxPoints
‚îÇ
‚îú‚îÄ‚îÄ homework_submissions/{submissionId}
‚îÇ   ‚îú‚îÄ‚îÄ homeworkId
‚îÇ   ‚îú‚îÄ‚îÄ studentId
‚îÇ   ‚îú‚îÄ‚îÄ submittedDate
‚îÇ   ‚îú‚îÄ‚îÄ content
‚îÇ   ‚îú‚îÄ‚îÄ grade
‚îÇ   ‚îî‚îÄ‚îÄ feedback
‚îÇ
‚îú‚îÄ‚îÄ lesson_plans/{planId}
‚îÇ   ‚îú‚îÄ‚îÄ classroomId
‚îÇ   ‚îú‚îÄ‚îÄ teacherId
‚îÇ   ‚îú‚îÄ‚îÄ subject, topic
‚îÇ   ‚îú‚îÄ‚îÄ date
‚îÇ   ‚îú‚îÄ‚îÄ objectives, content
‚îÇ   ‚îî‚îÄ‚îÄ materials
‚îÇ
‚îú‚îÄ‚îÄ conduct_notes/{noteId}
‚îÇ   ‚îú‚îÄ‚îÄ studentId
‚îÇ   ‚îú‚îÄ‚îÄ classroomId
‚îÇ   ‚îú‚îÄ‚îÄ teacherId
‚îÇ   ‚îú‚îÄ‚îÄ type, severity
‚îÇ   ‚îú‚îÄ‚îÄ description
‚îÇ   ‚îî‚îÄ‚îÄ parentNotified
‚îÇ
‚îú‚îÄ‚îÄ parent_student_relations/{relationId}
‚îÇ   ‚îú‚îÄ‚îÄ parentId
‚îÇ   ‚îú‚îÄ‚îÄ studentId
‚îÇ   ‚îú‚îÄ‚îÄ relationType
‚îÇ   ‚îî‚îÄ‚îÄ permissions{}
‚îÇ
‚îú‚îÄ‚îÄ parent_teacher_messages/{messageId}
‚îÇ   ‚îú‚îÄ‚îÄ senderId, recipientId
‚îÇ   ‚îú‚îÄ‚îÄ studentId
‚îÇ   ‚îú‚îÄ‚îÄ subject, message
‚îÇ   ‚îú‚îÄ‚îÄ priority
‚îÇ   ‚îî‚îÄ‚îÄ threadId
‚îÇ
‚îú‚îÄ‚îÄ school_announcements/{announcementId}
‚îÇ   ‚îú‚îÄ‚îÄ schoolId
‚îÇ   ‚îú‚îÄ‚îÄ title, content
‚îÇ   ‚îú‚îÄ‚îÄ type
‚îÇ   ‚îú‚îÄ‚îÄ publishDate
‚îÇ   ‚îî‚îÄ‚îÄ targetGradeLevels[]
‚îÇ
‚îî‚îÄ‚îÄ parent_teacher_meetings/{meetingId}
    ‚îú‚îÄ‚îÄ parentId, teacherId, studentId
    ‚îú‚îÄ‚îÄ scheduledDate
    ‚îú‚îÄ‚îÄ mode, location
    ‚îú‚îÄ‚îÄ status
    ‚îî‚îÄ‚îÄ outcome
```

---

## üîê Permissions √âtendues

### Culture Module
```dart
Permission.viewCulture          // Voir contenu
Permission.createCultureContent // Cr√©er
Permission.editCultureContent   // Modifier
Permission.deleteCultureContent // Supprimer
```

### Feature Flags
```dart
Feature.culture                 // Module culture
```

### Acc√®s par R√¥le

| Feature | Visitor | Student | Parent | Teacher | Director | Admin |
|---------|---------|---------|--------|---------|----------|-------|
| culture | ‚úÖ View | ‚úÖ View | ‚úÖ View | ‚úÖ Create | ‚úÖ Full | ‚úÖ Full |
| lessons | ‚úÖ Limited | ‚úÖ Full | ‚úÖ View | ‚úÖ Create | ‚úÖ Full | ‚úÖ Full |
| grades | ‚ùå | ‚úÖ View Own | ‚úÖ View Children | ‚úÖ Create | ‚úÖ View All | ‚úÖ Full |

---

## üéØ Flux de Donn√©es √âducatif

### Flux Notation

```
1. Enseignant cr√©e √©valuation (Homework/Quiz)
   ‚Üì
2. √âl√®ves soumettent travaux (HomeworkSubmission)
   ‚Üì
3. Enseignant corrige et note (Grade sur /20)
   ‚Üì
4. Notes stock√©es avec metadata
   ‚Üì
5. Calcul automatique moyennes
   ‚Üì
6. G√©n√©ration bulletin (ReportCard)
   ‚Üì
7. Parents notifi√©s
   ‚Üì
8. Consultation portail parent
```

### Flux Pr√©sences

```
1. Enseignant marque pr√©sences du jour
   ‚Üì
2. Enregistrement AttendanceRecord
   ‚Üì
3. Si absent ‚Üí Notification parent
   ‚Üì
4. Parent peut justifier
   ‚Üì
5. Statistiques calcul√©es
   ‚Üì
6. Affichage portail parent
```

### Flux Communication

```
Parent ‚Üí Message ‚Üí Teacher
   ‚Üì
Teacher re√ßoit notification
   ‚Üì
Teacher r√©pond
   ‚Üì
Parent re√ßoit notification
   ‚Üì
Thread conversation continue
```

---

## üì± State Management

### ViewModels √âducatifs (√Ä Cr√©er)

```dart
// ViewModel Enseignant
class TeacherViewModel extends ChangeNotifier {
  List<Classroom> _classrooms = [];
  List<Homework> _homework = [];
  List<AttendanceRecord> _todayAttendance = [];
  
  Future<void> loadClassrooms();
  Future<void> markAttendance(String studentId, AttendanceStatus);
  Future<void> createHomework(Homework);
  Future<void> gradeSubmission(String id, double grade);
}

// ViewModel Parent
class ParentViewModel extends ChangeNotifier {
  List<StudentProgressSummary> _childrenProgress = [];
  List<ParentTeacherMessage> _messages = [];
  List<ReportCard> _reportCards = [];
  
  Future<void> loadChildrenProgress();
  Future<void> sendMessage(ParentTeacherMessage);
  Future<void> scheduleMeeting(ParentTeacherMeeting);
}

// ViewModel Directeur
class DirectorViewModel extends ChangeNotifier {
  School? _school;
  List<Classroom> _classrooms = [];
  Map<String, dynamic> _statistics = {};
  
  Future<void> loadSchool();
  Future<void> createClassroom(Classroom);
  Future<void> publishAnnouncement(SchoolAnnouncement);
  Future<void> generateSchoolReport();
}
```

---

## üîÑ Int√©gration Routing

### Nouvelles Routes

```dart
// Teacher routes
GoRoute(path: '/teacher/classrooms', ...),
GoRoute(path: '/teacher/classroom/:id', ...),
GoRoute(path: '/teacher/attendance', ...),
GoRoute(path: '/teacher/homework', ...),
GoRoute(path: '/teacher/grades', ...),

// Parent routes
GoRoute(path: '/parent/dashboard', ...),
GoRoute(path: '/parent/student/:id', ...),
GoRoute(path: '/parent/messages', ...),
GoRoute(path: '/parent/meetings', ...),
GoRoute(path: '/parent/report-cards/:id', ...),

// Director routes
GoRoute(path: '/director/school', ...),
GoRoute(path: '/director/classrooms', ...),
GoRoute(path: '/director/teachers', ...),
GoRoute(path: '/director/announcements', ...),
GoRoute(path: '/director/analytics', ...),

// Admin routes
GoRoute(path: '/admin/schools', ...),
GoRoute(path: '/admin/users', ...),
GoRoute(path: '/admin/system', ...),
```

---

## üß™ Tests Sugg√©r√©s

### Tests Unitaires

```dart
// Test Grade calculation
test('should calculate correct letter grade', () {
  final grade = Grade(..., score: 17.0, maxScore: 20.0);
  expect(grade.percentage, 85.0);
  expect(grade.letterGrade, 'B');
  expect(grade.appreciation, 'Tr√®s Bien');
});

// Test ContentFilter
test('should recommend appropriate complexity', () {
  final complexity = ContentFilterService.getRecommendedComplexity(
    gradeLevel: GradeLevel.sixieme,
    performanceScore: 90.0,
  );
  expect(complexity, ContentComplexity.advanced); // +1 level
});

// Test Calendar
test('should generate correct Cameroon terms', () {
  final terms = AcademicCalendarService.generateCameroonTerms('2024-2025');
  expect(terms.length, 3);
  expect(terms[0].name, '1er Trimestre');
  expect(terms[0].termNumber, 1);
});
```

---

## üìà M√©triques et Analytics

### Indicateurs Enseignants
- Taux de pr√©sence classe
- Moyenne classe par mati√®re
- Taux de soumission devoirs
- Distribution notes (histogramme)
- √âl√®ves en difficult√©

### Indicateurs Parents
- Moyenne enfant
- Rang dans classe
- Taux pr√©sence
- Devoirs √† faire/termin√©s
- Messages non lus

### Indicateurs Directeur
- Effectifs par classe
- Moyennes par classe
- Taux pr√©sence √©cole
- Performance enseignants
- Statistiques MINEDUC

---

## üöÄ Prochaines Impl√©mentations

### Phase UI (Priorit√© 1)
1. [ ] Teacher dashboard UI
2. [ ] Parent portal UI
3. [ ] Student interface (adapt√©e par √¢ge)
4. [ ] Director panel UI
5. [ ] Admin school management UI

### Phase Backend (Priorit√© 2)
1. [ ] Firebase collections setup
2. [ ] Cloud Functions pour calculs
3. [ ] Real-time listeners
4. [ ] Batch operations (bulletins)
5. [ ] Backup et exports

### Phase Tests (Priorit√© 3)
1. [ ] Unit tests mod√®les
2. [ ] Integration tests flux complets
3. [ ] Widget tests UI
4. [ ] E2E tests scenarios utilisateurs
5. [ ] Performance tests (1000+ √©l√®ves)

---

## ‚úÖ Checklist D√©veloppeur

### Avant de Commencer
- [ ] Lire `EDUCATIONAL_SYSTEM_UPDATE.md`
- [ ] Lire `API_REFERENCE_EDUCATIONAL.md`
- [ ] Lire `QUICK_START_EDUCATIONAL.md`
- [ ] Comprendre hi√©rarchie √©ducative camerounaise
- [ ] Comprendre syst√®me notation /20

### Impl√©mentation UI
- [ ] Cr√©er √©crans enseignants
- [ ] Cr√©er √©crans parents
- [ ] Cr√©er √©crans √©l√®ves (adapt√©s)
- [ ] Cr√©er √©crans directeur
- [ ] Tester sur plusieurs √¢ges

### Int√©gration Backend
- [ ] Cr√©er collections Firestore
- [ ] Impl√©menter security rules
- [ ] Cr√©er Cloud Functions
- [ ] Tester CRUD operations
- [ ] Optimiser queries

### Testing
- [ ] Tests unitaires (100+ tests)
- [ ] Tests int√©gration
- [ ] Tests utilisateurs r√©els
- [ ] Validation par enseignants
- [ ] Validation par parents

---

**Document cr√©√©:** 7 octobre 2025  
**Version:** 2.0.0  
**Statut:** Sp√©cification Architecture Complete  
**Usage:** Guide impl√©mentation UI/Backend

