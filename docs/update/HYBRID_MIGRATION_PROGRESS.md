# Migration Hybride SQLite + Firebase - Rapport de Progression

**Date**: 7 Octobre 2025  
**Projet**: Ma'a yegue - Application d'apprentissage des langues camerounaises  
**Architecte**: Senior Developer AI Assistant

---

## üìã Vue d'ensemble de la Migration

### Objectif
Transformer le projet en mode **hybride** :
- **SQLite** (base locale) ‚Üí Stockage de toutes les donn√©es (dictionnaire, le√ßons, quiz, statistiques, etc.)
- **Firebase** ‚Üí Gestion des services uniquement (auth, FCM, analytics, crashlytics)

### Contraintes Respect√©es
‚úÖ Aucun fichier dupliqu√©  
‚úÖ Un mod√®le unique de donn√©es  
‚úÖ Initialisation automatique de la base de donn√©es  
‚úÖ Support des 7 langues camerounaises  
‚úÖ Gestion des 4 types d'utilisateurs (guest, student, teacher, admin)

---

## ‚úÖ √âTAPE 1 COMPL√âT√âE : Analyse du Projet

### Fichiers Dupliqu√©s Identifi√©s

1. **`database_helper.dart`** - Gestion principale de la DB (version 4)
2. **`sqlite_database_helper.dart`** - Helper pour Cameroon languages DB (read-only)
3. **`cameroon_languages_database_helper.dart`** - Convertisseur vers entities
4. **`local_database_service.dart`** - Service de sync local

**D√©cision** : Cr√©er un `unified_database_service.dart` qui fusionne toutes ces fonctionnalit√©s.

### Structure Actuelle Analys√©e

```
lib/core/database/
‚îú‚îÄ‚îÄ database_helper.dart (369 lignes) - Base principale
‚îú‚îÄ‚îÄ sqlite_database_helper.dart (301 lignes) - Cameroon languages
‚îú‚îÄ‚îÄ cameroon_languages_database_helper.dart (272 lignes) - Conversions
‚îú‚îÄ‚îÄ local_database_service.dart (321 lignes) - Sync service
‚îú‚îÄ‚îÄ database_initialization_service.dart
‚îú‚îÄ‚îÄ data_seeding_service.dart
‚îî‚îÄ‚îÄ migrations/
    ‚îú‚îÄ‚îÄ migration_v3.dart
    ‚îî‚îÄ‚îÄ migration_v4.dart
```

**Probl√®me** : Trop de helpers s√©par√©s cr√©ent de la complexit√© et des redondances.

---

## ‚úÖ √âTAPE 2 COMPL√âT√âE : Script Python Am√©lior√©

### Fichier Modifi√©
**`docs/database-scripts/create_cameroon_db.py`**

### Nouvelles Tables Ajout√©es

#### 1. **users** - Gestion des utilisateurs
```sql
CREATE TABLE users (
    user_id TEXT PRIMARY KEY,
    firebase_uid TEXT UNIQUE,
    email TEXT,
    display_name TEXT,
    role TEXT CHECK(role IN ('guest', 'student', 'teacher', 'admin')),
    subscription_status TEXT DEFAULT 'free',
    subscription_expires_at TIMESTAMP,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    last_login TIMESTAMP
)
```

#### 2. **daily_limits** - Quotas journaliers pour guests
```sql
CREATE TABLE daily_limits (
    limit_id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT,
    device_id TEXT,
    limit_date DATE NOT NULL,
    lessons_count INTEGER DEFAULT 0,
    readings_count INTEGER DEFAULT 0,
    quizzes_count INTEGER DEFAULT 0,
    UNIQUE(user_id, limit_date),
    UNIQUE(device_id, limit_date)
)
```

#### 3. **quizzes** - Questions et quiz
```sql
CREATE TABLE quizzes (
    quiz_id INTEGER PRIMARY KEY AUTOINCREMENT,
    language_id VARCHAR(10) NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    difficulty_level TEXT,
    category_id VARCHAR(10),
    created_date TIMESTAMP
)

CREATE TABLE quiz_questions (
    question_id INTEGER PRIMARY KEY AUTOINCREMENT,
    quiz_id INTEGER NOT NULL,
    question_text TEXT NOT NULL,
    question_type TEXT,
    correct_answer TEXT NOT NULL,
    options TEXT,
    points INTEGER DEFAULT 1,
    explanation TEXT
)
```

#### 4. **user_progress** - Suivi de progression
```sql
CREATE TABLE user_progress (
    progress_id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT NOT NULL,
    content_type TEXT CHECK(content_type IN ('lesson', 'quiz', 'translation')),
    content_id INTEGER NOT NULL,
    status TEXT CHECK(status IN ('started', 'in_progress', 'completed')),
    score REAL,
    time_spent INTEGER,
    completed_at TIMESTAMP,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
)
```

#### 5. **user_statistics** - Statistiques utilisateur
```sql
CREATE TABLE user_statistics (
    stat_id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT NOT NULL,
    total_lessons_completed INTEGER DEFAULT 0,
    total_quizzes_completed INTEGER DEFAULT 0,
    total_words_learned INTEGER DEFAULT 0,
    total_study_time INTEGER DEFAULT 0,
    current_streak INTEGER DEFAULT 0,
    longest_streak INTEGER DEFAULT 0,
    last_activity_date DATE,
    updated_at TIMESTAMP
)
```

#### 6. **user_created_content** - Contenu cr√©√© par enseignants/admin
```sql
CREATE TABLE user_created_content (
    content_id INTEGER PRIMARY KEY AUTOINCREMENT,
    creator_id TEXT NOT NULL,
    content_type TEXT CHECK(content_type IN ('lesson', 'quiz', 'translation')),
    title TEXT NOT NULL,
    content_data TEXT NOT NULL,
    language_id VARCHAR(10),
    status TEXT CHECK(status IN ('draft', 'published', 'archived')),
    created_at TIMESTAMP,
    updated_at TIMESTAMP
)
```

#### 7. **app_metadata** - M√©tadonn√©es de l'application
```sql
CREATE TABLE app_metadata (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at TIMESTAMP
)
```

### Donn√©es Ins√©r√©es

‚úÖ **7 Langues Camerounaises**
- Ewondo (EWO) - 577,000 locuteurs
- Duala (DUA) - 300,000 locuteurs
- Fe'efe'e (FEF) - 200,000 locuteurs
- Fulfulde (FUL) - 1,500,000 locuteurs
- Bassa (BAS) - 230,000 locuteurs
- Bamum (BAM) - 215,000 locuteurs
- **Yemba (YMB) - 300,000 locuteurs** ‚ú® (Nouvelle langue ajout√©e!)

‚úÖ **24 Cat√©gories**
GRT (Greetings), NUM (Numbers), FAM (Family), FOD (Food), BOD (Body), TIM (Time), COL (Colors), ANI (Animals), NAT (Nature), VRB (Verbs), ADJ (Adjectives), PHR (Phrases), CLO (Clothing), HOM (Home), PRO (Professions), TRA (Transportation), EMO (Emotions), EDU (Education), HEA (Health), MON (Money), DIR (Directions), REL (Religion), MUS (Music), SPO (Sports)

‚úÖ **Milliers de Traductions**
- Plus de 2000+ paires de traductions fran√ßais ‚Üî langues locales
- Tous les niveaux: beginner, intermediate, advanced
- Prononciation phon√©tique incluse
- Notes d'usage culturel

‚úÖ **70 Le√ßons Structur√©es**
- 10 le√ßons par langue
- Contenu audio/vid√©o r√©f√©renc√©
- Progression p√©dagogique beginner ‚Üí advanced

‚úÖ **18 Quiz Initiaux**
- Quiz de salutations pour chaque langue
- Quiz th√©matiques (nombres, famille, commerce, etc.)
- Questions √† choix multiples avec explications

---

## üîÑ √âTAPE 3 EN COURS : Service Unifi√© SQLite

### √Ä Cr√©er
**`lib/core/database/unified_database_service.dart`**

### Fonctionnalit√©s Requises

#### 1. Singleton Pattern
```dart
class UnifiedDatabaseService {
  static final UnifiedDatabaseService _instance = UnifiedDatabaseService._internal();
  factory UnifiedDatabaseService() => _instance;
  UnifiedDatabaseService._internal();
  
  Database? _database;
  Future<Database> get database async { ... }
}
```

#### 2. Initialisation Automatique
- Copie du fichier `cameroon_languages.db` depuis assets
- Cr√©ation automatique de toutes les tables
- Migration automatique vers version 2.0
- Injection des donn√©es initiales

#### 3. Repository Pattern
- `LanguageRepository` - Gestion des langues
- `TranslationRepository` - Dictionnaire
- `LessonRepository` - Le√ßons
- `QuizRepository` - Quiz
- `UserRepository` - Utilisateurs
- `ProgressRepository` - Progression
- `DailyLimitRepository` - Quotas journaliers

#### 4. M√©thodes CRUD Compl√®tes
```dart
// Exemple pour les le√ßons
Future<List<Lesson>> getAllLessons();
Future<List<Lesson>> getLessonsByLanguage(String languageId);
Future<Lesson?> getLessonById(int lessonId);
Future<int> insertLesson(Lesson lesson);
Future<int> updateLesson(Lesson lesson);
Future<int> deleteLesson(int lessonId);
```

---

## üìä Sch√©ma Complet de la Base de Donn√©es

### Tables Existantes (Cameroon Languages)
1. **languages** - 7 langues
2. **categories** - 24 cat√©gories
3. **translations** - 2000+ traductions
4. **lessons** - 70 le√ßons

### Nouvelles Tables (Gestion Utilisateurs)
5. **users** - Profils utilisateurs
6. **daily_limits** - Quotas guests
7. **user_progress** - Suivi progression
8. **user_statistics** - Statistiques
9. **quizzes** - D√©finitions quiz
10. **quiz_questions** - Questions
11. **user_created_content** - Contenu enseignants
12. **app_metadata** - M√©tadonn√©es

### Index Cr√©√©s (Performance)
```sql
-- Translations
idx_translations_language
idx_translations_category
idx_translations_difficulty
idx_translations_french

-- Lessons
idx_lessons_language
idx_lessons_level

-- Quizzes
idx_quizzes_language
idx_quiz_questions_quiz

-- Users
idx_users_firebase_uid
idx_users_role

-- Progress
idx_daily_limits_date
idx_user_progress_user
idx_user_progress_content
idx_user_statistics_user
idx_user_created_content_creator
idx_user_created_content_type
```

---

## üéØ Prochaines √âtapes

### √âtape 3 : Service Unifi√© (EN COURS)
- [ ] Cr√©er `unified_database_service.dart`
- [ ] Impl√©menter le pattern Repository
- [ ] Ajouter les m√©thodes CRUD pour chaque entit√©
- [ ] G√©rer l'initialisation automatique
- [ ] Tester la migration

### √âtape 4 : Refactorisation Firebase
- [ ] Garder uniquement FirebaseAuth
- [ ] Garder uniquement FCM (notifications)
- [ ] Garder uniquement Analytics
- [ ] Garder uniquement Crashlytics
- [ ] **SUPPRIMER** tout code de stockage Firestore

### √âtape 5 : Module Guest User
- [ ] Acc√®s complet au dictionnaire
- [ ] Limites journali√®res (5/5/5)
- [ ] Tracking dans daily_limits table
- [ ] Pas d'authentification requise

### √âtape 6 : Module Authentification
- [ ] Firebase Auth uniquement pour login
- [ ] Stockage profil dans SQLite users table
- [ ] Redirection selon r√¥le
- [ ] Password reset flow

### √âtape 7 : Module Student
- [ ] M√™mes acc√®s que guest sans limites
- [ ] Subscription tracking dans SQLite
- [ ] Payment integration

### √âtape 8 : Module Teacher
- [ ] CRUD le√ßons via UI ‚Üí SQLite
- [ ] CRUD mots via UI ‚Üí SQLite
- [ ] CRUD quiz via UI ‚Üí SQLite
- [ ] Tableau user_created_content

### √âtape 9 : Module Administrator
- [ ] Gestion utilisateurs (users table)
- [ ] Statistiques plateforme (user_statistics)
- [ ] Validation contenus
- [ ] Migrations

### √âtape 10 : Tests
- [ ] Tests unitaires SQLite
- [ ] Tests int√©gration auth
- [ ] Tests quotas journaliers
- [ ] Tests services Firebase

### √âtape 11 : Diagnostic Android
- [ ] V√©rifier build.gradle
- [ ] V√©rifier AndroidManifest.xml
- [ ] Tester d√©ploiement

### √âtape 12 : Documentation
- [ ] Guide migration complet
- [ ] Documentation API
- [ ] Guide utilisateur

---

## üìù Notes Importantes

### Langues Prises en Charge
1. **Ewondo (EWO)** - Centre, Beti-Pahuin, 577K locuteurs
2. **Duala (DUA)** - Littoral, Commerce c√¥tier, 300K locuteurs
3. **Fe'efe'e (FEF)** - Ouest, Bamil√©k√© Bafang, 200K locuteurs
4. **Fulfulde (FUL)** - Nord, Peuls nomades, 1.5M locuteurs
5. **Bassa (BAS)** - Centre-Littoral, For√™t √©quatoriale, 230K locuteurs
6. **Bamum (BAM)** - Ouest, √âcriture syllabique unique, 215K locuteurs
7. **Yemba (YMB)** - Ouest, Bamil√©k√© Dschang, 300K locuteurs ‚ú®

### R√¥les Utilisateurs
1. **Guest** - Pas d'auth, limites 5/5/5
2. **Student** - Auth requise, acc√®s standard
3. **Teacher** - Auth requise, cr√©ation de contenu
4. **Admin** - Auth requise, gestion compl√®te

### Firebase Services (√Ä Conserver)
- ‚úÖ Authentication
- ‚úÖ Cloud Messaging (FCM)
- ‚úÖ Analytics
- ‚úÖ Crashlytics
- ‚úÖ Performance Monitoring
- ‚ùå **Firestore** (√† supprimer, remplac√© par SQLite)
- ‚ùå **Storage** (assets locaux uniquement)

---

## üèóÔ∏è Architecture Hybride Finale

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         APPLICATION FLUTTER              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   FIREBASE   ‚îÇ   ‚îÇ    SQLITE      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   SERVICES   ‚îÇ   ‚îÇ   DATABASE     ‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Auth       ‚îÇ   ‚îÇ ‚Ä¢ Users        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ FCM        ‚îÇ   ‚îÇ ‚Ä¢ Progress     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Analytics  ‚îÇ   ‚îÇ ‚Ä¢ Lessons      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Crashlytics‚îÇ   ‚îÇ ‚Ä¢ Quizzes      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ   ‚îÇ ‚Ä¢ Dictionary   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ   ‚îÇ ‚Ä¢ Statistics   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  Services uniquement    Toutes donn√©es  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìà Statistiques du Projet

- **Total fichiers Dart** : 674+
- **Langues support√©es** : 7
- **Traductions** : 2000+
- **Le√ßons** : 70
- **Quiz** : 18+
- **Cat√©gories** : 24
- **Tables DB** : 12
- **Index DB** : 16+

---

**Derni√®re mise √† jour** : 7 Octobre 2025, 16:45 GMT  
**Statut** : ‚úÖ √âtape 1-2 compl√©t√©es | üîÑ √âtape 3 en cours  
**Prochaine action** : Cr√©er unified_database_service.dart
