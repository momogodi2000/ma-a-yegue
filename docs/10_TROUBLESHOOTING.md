# üîß GUIDE DE D√âPANNAGE - MA'A YEGUE

## üéØ Solutions aux Probl√®mes Courants

Guide complet pour r√©soudre rapidement les probl√®mes techniques.

---

## üì± PROBL√àMES APPLICATION

### ‚ùå L'application ne d√©marre pas

#### Sympt√¥me
App crash imm√©diatement apr√®s lancement, √©cran blanc, ou fermeture automatique.

#### Diagnostic
```bash
# Capturer logs
flutter logs > startup_crash.txt

# Chercher erreur
cat startup_crash.txt | grep -i "error\|exception\|fatal"
```

#### Solutions

**1. Base de donn√©es manquante**
```
Erreur: "Error opening database"
ou: "No such file: cameroon_languages.db"

Solution:
cd docs/database-scripts
python create_cameroon_db.py
cp cameroon_languages.db ../../assets/databases/
flutter clean
flutter pub get
flutter run
```

**2. Firebase non configur√©**
```
Erreur: "FirebaseException: No Firebase App"

Solution:
1. V√©rifier google-services.json dans android/app/
2. V√©rifier GoogleService-Info.plist dans ios/Runner/
3. flutter clean && flutter pub get
```

**3. D√©pendances corrompues**
```
Solution:
flutter clean
flutter pub cache clean
flutter pub get
```

**4. Permissions manquantes**
```
V√©rifier AndroidManifest.xml contient:
<uses-permission android:name="android.permission.INTERNET"/>
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
```

---

### ‚è±Ô∏è L'application est lente

#### Sympt√¥me
Temps de chargement long, UI qui lag, animations saccad√©es.

#### Diagnostic
```dart
// Profiler op√©rations
final stopwatch = Stopwatch()..start();
final result = await myOperation();
stopwatch.stop();
print('Operation took: ${stopwatch.elapsedMilliseconds}ms');
```

#### Solutions

**1. Base de donn√©es non optimis√©e**
```dart
// V√©rifier indexes
final suggestions = await DatabaseQueryOptimizer.analyzeIndexes();

// Si indexes manquants: les cr√©er
// Puis:
await database.execute('VACUUM');
await database.execute('ANALYZE');
```

**2. Requ√™tes inefficaces**
```dart
// ‚ùå Mauvais: N+1 queries
for (var lesson in lessons) {
  final progress = await db.getProgress(userId, 'lesson', lesson.id);
}

// ‚úÖ Bon: Une requ√™te avec JOIN
final lessonsWithProgress = await db.rawQuery('''
  SELECT l.*, p.status, p.score
  FROM cameroon.lessons l
  LEFT JOIN user_progress p ON p.content_id = l.lesson_id
  WHERE p.user_id = ?
''', [userId]);
```

**3. Images non optimis√©es**
```dart
// Utiliser cached_network_image
CachedNetworkImage(
  imageUrl: imageUrl,
  placeholder: (context, url) => CircularProgressIndicator(),
  errorWidget: (context, url, error) => Icon(Icons.error),
)

// Compresser images locales
flutter pub run flutter_image_compress:compress assets/images/
```

**4. Trop de widgets rebuilds**
```dart
// Utiliser const quand possible
const Text('Static Text');

// Utiliser keys pour optimiser rebuilds
ListView.builder(
  itemBuilder: (context, index) {
    return ListTile(
      key: ValueKey(items[index].id),  // IMPORTANT
      title: Text(items[index].title),
    );
  },
)
```

---

### üîê Probl√®mes d'Authentification

#### ‚ùå "Email already in use"

**Cause** : Email d√©j√† enregistr√©.

**Solutions** :
```
1. Utilisateur a oubli√© ‚Üí "Mot de passe oubli√©"
2. Typo dans email ‚Üí V√©rifier orthographe
3. Compte existant autre provider ‚Üí Utiliser m√™me provider
```

#### ‚ùå "Wrong password"

**Solution** :
```
1. V√©rifier Caps Lock d√©sactiv√©
2. Essayer reset password
3. Si probl√®me persiste: contacter support
```

#### ‚ùå "User not found"

**Cause** : Compte n'existe pas ou supprim√©.

**Solution** :
```
1. V√©rifier email correct
2. Si s√ªr d'avoir compte: peut avoir √©t√© supprim√©
3. Cr√©er nouveau compte
```

#### ‚ùå "Network error" lors connexion

**Cause** : Pas de connexion internet ou Firebase inaccessible.

**Solution** :
```
1. V√©rifier connexion internet
2. Essayer data mobile si sur WiFi (ou inverse)
3. V√©rifier status Firebase: https://status.firebase.google.com
4. R√©essayer dans quelques minutes
```

---

### üí≥ Probl√®mes de Paiement

#### ‚ùå Paiement reste "pending"

**Diagnostic** :
```sql
SELECT * FROM payments WHERE status = 'pending' ORDER BY created_at DESC LIMIT 10;
```

**Solutions** :

**1. Webhook pas re√ßu**
```
Cause: Gateway pas envoy√© webhook ou √©chec r√©seau

Solution:
- V√©rifier logs gateway (Campay/Stripe dashboard)
- Obtenir statut r√©el transaction
- Mettre √† jour manuellement si pay√©:

UPDATE payments SET 
  status = 'completed',
  completed_at = strftime('%s', 'now') * 1000
WHERE payment_id = 'pay-xxx';

-- Activer abonnement
```

**2. Validation √©chou√©e**
```
Cause: Montant incorrect, signature invalide

Solution:
- V√©rifier montant matches
- V√©rifier API keys correctes
- V√©rifier environnement (test vs prod)
```

**3. Utilisateur a ferm√© avant fin**
```
Cause: Utilisateur a quitt√© processus

Solution:
- Laisser pendant 24h
- Si toujours pending: marquer abandoned
- Notifier utilisateur avec lien pour compl√©ter
```

#### ‚ùå Abonnement actif mais acc√®s refus√©

**Diagnostic** :
```sql
-- V√©rifier abonnement
SELECT * FROM subscriptions WHERE user_id = 'user-xxx' AND status = 'active';

-- V√©rifier statut utilisateur
SELECT subscription_status, subscription_expires_at FROM users WHERE user_id = 'user-xxx';
```

**Solution** :
```dart
// Synchroniser statut
final subscription = await db.getUserActiveSubscription(userId);

if (subscription != null) {
  await db.upsertUser({
    'user_id': userId,
    'subscription_status': 'premium',
    'subscription_expires_at': subscription['end_date'],
    'updated_at': DateTime.now().millisecondsSinceEpoch,
  });
}
```

---

## üóÑÔ∏è PROBL√àMES BASE DE DONN√âES

### ‚ùå "Database is locked"

**Cause** : Multiple transactions simultan√©es.

**Solutions** :

**1. Augmenter timeout**
```dart
await openDatabase(
  path,
  options: OpenDatabaseOptions(
    version: 1,
    busyTimeout: Duration(seconds: 10),  // D√©faut: 5s
  ),
);
```

**2. √âviter longues transactions**
```dart
// ‚ùå Mauvais
await db.transaction((txn) async {
  for (int i = 0; i < 10000; i++) {
    await txn.insert('table', data[i]);  // TR√àS LENT
  }
});

// ‚úÖ Bon
await db.transaction((txn) async {
  final batch = txn.batch();
  for (int i = 0; i < 10000; i++) {
    batch.insert('table', data[i]);
  }
  await batch.commit();  // RAPIDE
});
```

**3. Fermer connexions inutiles**
```dart
// Utiliser singleton (d√©j√† fait)
final db = UnifiedDatabaseService.instance;
// NE PAS cr√©er nouvelles instances
```

### ‚ùå "No such table: ..."

**Cause** : Table pas cr√©√©e ou mauvaise base de donn√©es.

**Solutions** :

**1. DB non initialis√©e**
```dart
// Forcer initialisation
await UnifiedDatabaseService.instance.database;
```

**2. Mauvaise base (main vs cameroon)**
```dart
// ‚ùå Erreur: Table "languages" dans DB principale
await db.query('languages');  // N'existe pas

// ‚úÖ Correct: Table dans DB cameroon (attach√©e)
await db.rawQuery('SELECT * FROM cameroon.languages');
```

**3. Migration pas ex√©cut√©e**
```dart
// V√©rifier version DB
final version = await db.getMetadata('db_version');
print('DB Version: $version');

// Si version ancienne: app devrait migrer automatiquement
// Si pas migr√©: supprimer DB et r√©initialiser
await db.deleteDatabase();
// Red√©marrer app
```

### ‚ùå Base de donn√©es trop grande

**Sympt√¥me** : DB > 500 MB, app utilise beaucoup d'espace.

**Solutions** :

**1. Nettoyer donn√©es anciennes**
```sql
-- Supprimer progr√®s ancien (> 6 mois)
DELETE FROM user_progress 
WHERE completed_at < strftime('%s', 'now', '-180 days') * 1000;

-- Supprimer limites invit√©s (> 30 jours)
DELETE FROM daily_limits 
WHERE limit_date < DATE('now', '-30 days');
```

**2. VACUUM**
```sql
VACUUM;
-- Peut r√©duire taille de 30-50%
```

**3. Archiver donn√©es**
```dart
// Exporter anciennes donn√©es vers fichier
// Puis supprimer de DB active
```

---

## üåê PROBL√àMES R√âSEAU

### ‚ùå "Network request failed"

**Diagnostic** :
```dart
// Tester connectivit√©
final connectivity = await Connectivity().checkConnectivity();
print('Connection: $connectivity');  // wifi, mobile, none

// Tester Firebase
try {
  await Firebase.initializeApp();
  print('‚úÖ Firebase accessible');
} catch (e) {
  print('‚ùå Firebase inaccessible: $e');
}
```

**Solutions** :

**1. Pas de connexion**
```
- V√©rifier WiFi/Data activ√©s
- Essayer r√©seau diff√©rent
- V√©rifier pas de firewall bloquant
```

**2. Firebase status**
```
- V√©rifier https://status.firebase.google.com
- Si rouge: attendre r√©solution Google
- Si vert: probl√®me local (reboot appareil)
```

**3. Timeout trop court**
```dart
// Augmenter timeout Dio
final dio = Dio(BaseOptions(
  connectTimeout: Duration(seconds: 30),  // D√©faut: 10s
  receiveTimeout: Duration(seconds: 30),
));
```

### ‚ùå Notifications push non re√ßues

**Diagnostic** :
```dart
// 1. V√©rifier token FCM
final token = await FirebaseMessaging.instance.getToken();
print('FCM Token: $token');

// 2. V√©rifier permissions
final settings = await FirebaseMessaging.instance.requestPermission();
print('Permissions: ${settings.authorizationStatus}');
```

**Solutions** :

**1. Permissions refus√©es**
```
Android: Settings ‚Üí Apps ‚Üí Ma'a yegue ‚Üí Notifications ‚Üí Enable
iOS: Settings ‚Üí Notifications ‚Üí Ma'a yegue ‚Üí Allow Notifications
```

**2. Token pas sauvegard√©**
```dart
// Reg√©n√©rer et sauvegarder
final token = await FirebaseMessaging.instance.getToken();
await db.upsertUser({
  'user_id': userId,
  'fcm_token': token,
  'fcm_token_updated_at': DateTime.now().toIso8601String(),
});
```

**3. Topic pas souscrit**
```dart
// Souscrire √† topic
await FirebaseMessaging.instance.subscribeToTopic('all_users');
await FirebaseMessaging.instance.subscribeToTopic('ewondo_learners');
```

**4. Tester notification manuelle**
```
Firebase Console ‚Üí Cloud Messaging ‚Üí Send test message
Enter FCM token ‚Üí Test
```

---

## üèóÔ∏è PROBL√àMES DE BUILD

### ‚ùå Build √©choue (Android)

#### Erreur: "Execution failed for task ':app:processDebugResources'"

**Cause** : Probl√®me resources ou Gradle.

**Solution** :
```bash
# Nettoyer compl√®tement
flutter clean
cd android
./gradlew clean
cd ..

# Supprimer .gradle
rm -rf android/.gradle
rm -rf android/app/.gradle

# Rebuild
flutter pub get
flutter build apk
```

#### Erreur: "Unsupported class file major version 65"

**Cause** : Version Java incompatible.

**Solution** :
```
V√©rifier Java version:
java -version

Doit √™tre Java 11 ou 17 (pas 21+)

Changer dans android/app/build.gradle.kts:
compileOptions {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}
```

#### Erreur: "Duplicate class found"

**Cause** : D√©pendances conflictuelles.

**Solution** :
```kotlin
// android/app/build.gradle.kts
configurations.all {
    exclude(group = "org.jetbrains.kotlin", module = "kotlin-stdlib-jdk7")
    exclude(group = "org.jetbrains.kotlin", module = "kotlin-stdlib-jdk8")
}
```

### ‚ùå Build √©choue (iOS)

#### Erreur: "CocoaPods not installed"

**Solution** :
```bash
# Installer CocoaPods
sudo gem install cocoapods

# Installer pods
cd ios
pod install
cd ..

# Rebuild
flutter build ios
```

#### Erreur: "Signing requires a development team"

**Solution** :
```
1. Ouvrir ios/Runner.xcworkspace dans Xcode
2. S√©lectionner target Runner
3. Signing & Capabilities
4. Team: S√©lectionner votre Apple Developer team
5. Rebuild depuis Xcode ou Flutter
```

---

## üî• PROBL√àMES FIREBASE

### ‚ùå "FirebaseException: PERMISSION_DENIED"

**Cause** : Firestore rules trop restrictives.

**Solution** :
```javascript
// firestore.rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Temporaire pour debug (ATTENTION: pas pour prod)
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // Apr√®s debug: r√®gles strictes
    match /users/{userId} {
      allow read: if request.auth.uid == userId;
      allow write: if request.auth.uid == userId;
    }
  }
}
```

### ‚ùå Analytics events non visibles dans console

**Cause** : D√©lai de propagation ou DebugView pas activ√©.

**Solutions** :

**1. Activer DebugView**
```bash
# Android
adb shell setprop debug.firebase.analytics.app com.maa_yegue.app

# iOS
flutter run --dart-define=FIREBASE_ANALYTICS_DEBUG_MODE=true
```

**2. Attendre**
```
Analytics events apparaissent dans console apr√®s:
- DebugView: Temps r√©el
- Dashboard: 24-48 heures
```

**3. V√©rifier events envoy√©s**
```dart
import 'package:flutter/foundation.dart';

if (kDebugMode) {
  print('üìä Logging event: lesson_start');
}

await FirebaseAnalytics.instance.logEvent(
  name: 'lesson_start',
  parameters: {'lesson_id': '1'},
);
```

### ‚ùå Crashlytics ne reporte pas crashes

**Solutions** :

**1. Activer en debug**
```dart
// main.dart
if (kDebugMode) {
  await FirebaseCrashlytics.instance.setCrashlyticsCollectionEnabled(true);
}
```

**2. Forcer crash test**
```dart
// Ajouter bouton debug pour tester
FirebaseCrashlytics.instance.crash();  // Force crash
```

**3. V√©rifier configuration**
```
Firebase Console ‚Üí Crashlytics ‚Üí Ensure SDK setup correctly
```

---

## üìä PROBL√àMES DE DONN√âES

### ‚ùå Limites invit√© ne se r√©initialisent pas

**Diagnostic** :
```sql
-- V√©rifier limites actuelles
SELECT * FROM daily_limits WHERE device_id = 'device-xxx' ORDER BY limit_date DESC LIMIT 7;
```

**Cause** : Date syst√®me incorrecte ou bug calcul date.

**Solution** :
```dart
// V√©rifier calcul date
final today = DateTime.now().toIso8601String().split('T')[0];
print('Today: $today');  // Doit √™tre YYYY-MM-DD

// Si bug: nettoyer et recr√©er
await db.database.then((database) async {
  await database.delete('daily_limits', where: 'device_id = ?', whereArgs: [deviceId]);
});
```

### ‚ùå Progr√®s non sauvegard√©

**Diagnostic** :
```dart
// V√©rifier si utilisateur authentifi√©
final user = await HybridAuthService.getCurrentUser();
if (user == null) {
  print('‚ùå User not authenticated - progress NOT saved');
} else {
  print('‚úÖ User authenticated - progress saved');
}
```

**Cause** : Utilisateur invit√© (pas authentifi√©).

**Solution** :
```
Invit√©s ne peuvent pas sauvegarder progr√®s.
‚Üí Encourager inscription pour sauvegarder progr√®s.
‚Üí Message UI: "Inscrivez-vous pour sauvegarder votre progr√®s!"
```

### ‚ùå Statistiques incorrectes

**Diagnostic** :
```sql
-- V√©rifier coh√©rence
SELECT 
  u.user_id,
  s.total_lessons_completed,
  (SELECT COUNT(*) FROM user_progress WHERE user_id = u.user_id AND content_type = 'lesson' AND status = 'completed') as actual_completed
FROM users u
LEFT JOIN user_statistics s ON u.user_id = s.user_id
WHERE u.user_id = 'user-xxx';

-- Si diff√©rence: recalculer
```

**Solution** : Recalculer statistiques
```dart
Future<void> recalculateUserStatistics(String userId) async {
  final database = await db.database;
  
  // Compter le√ßons compl√©t√©es
  final lessonsResult = await database.rawQuery(
    'SELECT COUNT(*) as count FROM user_progress WHERE user_id = ? AND content_type = "lesson" AND status = "completed"',
    [userId],
  );
  final lessonsCount = Sqflite.firstIntValue(lessonsResult) ?? 0;
  
  // Compter quiz compl√©t√©s
  final quizzesResult = await database.rawQuery(
    'SELECT COUNT(*) as count FROM user_progress WHERE user_id = ? AND content_type = "quiz" AND status = "completed"',
    [userId],
  );
  final quizzesCount = Sqflite.firstIntValue(quizzesResult) ?? 0;
  
  // Calculer temps total
  final timeResult = await database.rawQuery(
    'SELECT SUM(time_spent) as total FROM user_progress WHERE user_id = ?',
    [userId],
  );
  final totalTime = Sqflite.firstIntValue(timeResult) ?? 0;
  
  // Mettre √† jour
  await db.upsertUserStatistics(userId, {
    'total_lessons_completed': lessonsCount,
    'total_quizzes_completed': quizzesCount,
    'total_study_time': totalTime,
  });
  
  print('‚úÖ Statistics recalculated for $userId');
}
```

---

## üñ•Ô∏è PROBL√àMES SP√âCIFIQUES ANDROID

### ‚ùå "Cleartext HTTP traffic not permitted"

**Cause** : Android bloque HTTP (non-HTTPS) par d√©faut.

**Solution** :
```xml
<!-- android/app/src/main/AndroidManifest.xml -->
<application
    android:usesCleartextTraffic="true"  <!-- Ajouter si n√©cessaire -->
    ...>
```

**Meilleure solution** : Utiliser HTTPS partout.

### ‚ùå App ne s'installe pas ("App not installed")

**Solutions** :

**1. Signature diff√©rente**
```bash
# D√©sinstaller ancienne version
adb uninstall com.maa_yegue.app

# R√©installer
flutter install
```

**2. Espace insuffisant**
```bash
# V√©rifier espace
adb shell df /data

# Si plein: nettoyer ou utiliser autre appareil
```

**3. Version Android incompatible**
```
App requiert Android 7+ (API 24)
V√©rifier version appareil: Settings ‚Üí About Phone ‚Üí Android Version
```

### ‚ùå "INSTALL_FAILED_UPDATE_INCOMPATIBLE"

**Solution** :
```bash
# D√©sinstaller compl√®tement
adb uninstall com.maa_yegue.app

# R√©installer
flutter run
```

---

## üçé PROBL√àMES SP√âCIFIQUES iOS

### ‚ùå "Runner.app could not be found"

**Solution** :
```bash
cd ios
pod deintegrate
pod install
cd ..
flutter clean
flutter build ios
```

### ‚ùå "Code signing error"

**Solution** :
```
1. Ouvrir ios/Runner.xcworkspace dans Xcode
2. Signing & Capabilities
3. Team: Select your team
4. Automatic signing: Enable
5. Clean build folder (Cmd+Shift+K)
6. Build (Cmd+B)
```

---

## üß™ PROBL√àMES DE TESTS

### ‚ùå Tests √©chouent: "MissingPluginException"

**Cause** : Plugin natif pas initialis√© dans tests.

**Solution** :
```dart
// test/test_config.dart
void initializeTestEnvironment() {
  TestWidgetsFlutterBinding.ensureInitialized();
  
  // Mock pour SQLite
  sqfliteFfiInit();
  databaseFactory = databaseFactoryFfi;
  
  // Autres initialisations
}

// Dans chaque test file
void main() {
  setUpAll(() {
    initializeTestEnvironment();
  });
  
  // tests...
}
```

### ‚ùå Tests tr√®s lents

**Cause** : DB pas supprim√©e entre tests, accumulation donn√©es.

**Solution** :
```dart
setUp(() async {
  await db.deleteDatabase();  // DB propre pour chaque test
});

tearDown() async {
  await db.close();
});
```

---

## üîÑ PROBL√àMES DE MIGRATION

### ‚ùå Migration √©choue apr√®s update app

**Sympt√¥me** : App crash apr√®s mise √† jour.

**Diagnostic** :
```dart
// V√©rifier version DB
final version = await db.getMetadata('db_version');
print('Current DB version: $version');
print('Expected version: $_databaseVersion');
```

**Solution** :

**Option A : Forcer migration manuelle**
```dart
final database = await db.database;
// Ex√©cuter migration manuellement
await _migrateV2ToV3(database);
```

**Option B : R√©initialiser DB (perte donn√©es)**
```dart
await db.deleteDatabase();
// App recr√©e DB √† la version actuelle
// ATTENTION: Perte de toutes les donn√©es utilisateur
```

**Pr√©vention** :
- Toujours tester migrations avant prod
- Backup DB avant mise √† jour majeure
- Rollout progressif pour d√©tecter probl√®mes t√¥t

---

## üé® PROBL√àMES UI

### ‚ùå Images ne chargent pas

**Solutions** :

**1. V√©rifier path**
```dart
// ‚ùå Mauvais
Image.asset('logo.png');

// ‚úÖ Bon
Image.asset('assets/logo/logo.jpg');
```

**2. V√©rifier pubspec.yaml**
```yaml
flutter:
  assets:
    - assets/logo/
    - assets/databases/
```

**3. Rebuild apr√®s modification pubspec**
```bash
flutter pub get
flutter run
```

### ‚ùå Texte tronqu√© ou overflow

**Solution** :
```dart
// Utiliser Flexible ou Expanded
Row(
  children: [
    Expanded(  // ou Flexible
      child: Text(
        'Long text here that might overflow...',
        overflow: TextOverflow.ellipsis,
        maxLines: 2,
      ),
    ),
  ],
)
```

---

## üö® PROBL√àMES CRITIQUES

### üî• URGENCE: App crashe pour tous les utilisateurs

**PROC√âDURE D'URGENCE** :

```
MINUTE 0-5: ASSESSMENT
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Ouvrir Crashlytics imm√©diatement
2. Identifier crash et pourcentage affect√©
3. Noter versions affect√©es
4. Alerter √©quipe (Slack/SMS)

MINUTE 5-15: MITIGATION IMM√âDIATE
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Option A: Remote Config
  firebase console ‚Üí Remote Config
  ‚Üí Set "maintenance_mode" = true
  ‚Üí Publish
  ‚Üí App affiche √©cran maintenance au lieu de crasher

Option B: Rollback Store
  Google Play Console ‚Üí Production
  ‚Üí Halt rollout
  ‚Üí Promote previous version

MINUTE 15-120: FIX
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. git checkout develop
2. git pull
3. Reproduire crash localement
4. Identifier cause (stack trace)
5. D√©velopper fix
6. Tester exhaustivement (20+ fois)
7. Code review rapide (2 personnes)
8. Merge hotfix

MINUTE 120-180: DEPLOY
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Increment version (ex: 2.1.5 ‚Üí 2.1.6)
2. flutter build appbundle --release
3. Upload vers Play Store (emergency track)
4. Rollout: 10% ‚Üí monitor 30min ‚Üí 50% ‚Üí 100%

POST-INCIDENT (J+1):
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Post-mortem meeting
2. Documenter incident
3. Identifier cause racine
4. Mettre en place pr√©ventions
5. Am√©liorer tests
6. Update runbooks
```

---

## üîç OUTILS DE DIAGNOSTIC

### Commandes Utiles

```bash
# Flutter
flutter doctor -v            # V√©rifier environnement
flutter devices              # Lister appareils
flutter logs                 # Voir logs en temps r√©el
flutter analyze              # Analyser code
flutter test                 # Lancer tests
flutter clean                # Nettoyer build

# Android
adb devices                  # Lister appareils
adb logcat                   # Logs syst√®me
adb shell pm list packages   # Lister apps install√©es
adb uninstall com.maa_yegue.app  # D√©sinstaller
adb install app.apk          # Installer APK

# Git
git status                   # √âtat working directory
git log --oneline -10        # 10 derniers commits
git diff                     # Changements non committed
git stash                    # Mettre changements de c√¥t√©

# Database
sqlite3 maa_yegue_app.db     # Ouvrir DB
.tables                      # Lister tables
.schema users                # Voir schema
SELECT * FROM users LIMIT 5; # Query
```

### Scripts de Diagnostic

**Fichier** : `scripts/diagnose.dart`

```dart
import 'package:maa_yegue/core/database/unified_database_service.dart';

Future<void> runDiagnostics() async {
  print('üîç DIAGNOSTIC MA\'A YEGUE');
  print('‚ïê' * 60);
  
  try {
    // 1. Base de donn√©es
    print('\nüóÑÔ∏è Base de Donn√©es:');
    final db = UnifiedDatabaseService.instance;
    final database = await db.database;
    print('‚úÖ DB accessible: ${database.path}');
    
    final integrityCheck = await database.rawQuery('PRAGMA integrity_check');
    print('Int√©grit√©: ${integrityCheck.first['integrity_check']}');
    
    final version = await db.getMetadata('db_version');
    print('Version: $version');
    
    // 2. Langues
    print('\nüåç Langues:');
    final languages = await db.getAllLanguages();
    print('Total langues: ${languages.length}');
    languages.forEach((lang) => print('  - ${lang['language_name']} (${lang['language_id']})'));
    
    // 3. Statistiques
    print('\nüìä Statistiques:');
    final platformStats = await db.getPlatformStatistics();
    print('Total utilisateurs: ${platformStats['total_users']}');
    print('Total traductions: ${platformStats['total_translations']}');
    print('Total le√ßons: ${platformStats['total_lessons']}');
    
    // 4. Performance
    print('\n‚ö° Performance:');
    final cacheStats = DatabaseQueryOptimizer.getCacheStats();
    print('Cache items: ${cacheStats['cached_items']}');
    
    print('\n‚úÖ Diagnostic termin√© - Aucun probl√®me d√©tect√©');
  } catch (e, stack) {
    print('\n‚ùå ERREUR D√âTECT√âE:');
    print(e);
    print(stack);
  }
}

void main() async {
  await runDiagnostics();
}
```

**Ex√©cuter** :
```bash
dart run scripts/diagnose.dart
```

---

## üìû ESCALADE PROBL√àMES

### Niveau 1: Self-Service (0-30 min)

```
1. Consulter cette documentation
2. Rechercher erreur exacte sur Google/StackOverflow
3. V√©rifier GitHub Issues similaires
4. Essayer solutions propos√©es
```

### Niveau 2: Support √âquipe (30 min - 2h)

```
1. Cr√©er ticket GitHub avec:
   - Description probl√®me
   - Steps to reproduce
   - Logs pertinents
   - Configuration (OS, Flutter version)
   
2. Notifier sur Slack #tech-support

3. Si urgent: Appeler tech lead
```

### Niveau 3: External Support (> 2h)

```
1. Flutter GitHub Issues
2. Firebase Support (si probl√®me Firebase)
3. Plugin maintainer (si probl√®me plugin)
4. Stack Overflow (question d√©taill√©e)
```

---

## ‚úÖ CHECKLIST D√âPANNAGE

Avant de d√©clarer un probl√®me "non r√©solu", v√©rifier:

### G√©n√©ral
- [ ] `flutter clean` effectu√©
- [ ] `flutter pub get` ex√©cut√©
- [ ] App red√©marr√©e
- [ ] Appareil red√©marr√©
- [ ] Flutter et d√©pendances √† jour
- [ ] `flutter doctor` sans erreurs

### Base de Donn√©es
- [ ] Fichier cameroon_languages.db pr√©sent
- [ ] PRAGMA integrity_check = ok
- [ ] Indexes cr√©√©s
- [ ] Version DB correcte

### Firebase
- [ ] google-services.json pr√©sent (Android)
- [ ] Firebase initialis√© dans code
- [ ] Firebase status page verte
- [ ] Connexion internet fonctionnelle

### Build
- [ ] Gradle sync r√©ussi (Android)
- [ ] Pods install√©s (iOS)
- [ ] Signing configur√©
- [ ] Permissions dans manifests

### Tests
- [ ] Tests unitaires passent
- [ ] Tests int√©gration passent
- [ ] Test√© sur √©mulateur
- [ ] Test√© sur appareil r√©el

Si tout coch√© et probl√®me persiste: Cr√©er ticket d√©taill√©.

---

## ‚úÖ R√âSUM√â

Ce guide couvre les **probl√®mes les plus fr√©quents** et leurs solutions.

**Taux de r√©solution attendu** : 
- 80% des probl√®mes r√©solus par flutter clean + pub get
- 15% r√©solus par solutions document√©es ici
- 5% n√©cessitent investigation approfondie

**Temps moyen de r√©solution** :
- Probl√®me simple : 5-10 minutes
- Probl√®me moyen : 30-60 minutes  
- Probl√®me complexe : 2-4 heures

Pour probl√®mes non couverts, consulter √©quipe technique ou cr√©er GitHub Issue.

---

**Document cr√©√©** : 7 Octobre 2025  
**Derni√®re mise √† jour** : 7 Octobre 2025  
**Fichiers li√©s** :
- `09_FAQ_TECHNIQUE.md`
- `06_GUIDE_DEVELOPPEUR.md`
- `07_GUIDE_OPERATIONNEL.md`
